<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <title>ARcade AR Viewer</title>
  <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.2/aframe/build/aframe-ar.min.js"></script>
  <style>
    body { margin: 0; overflow: hidden; }
  </style>
</head>

<body>
  <a-scene embedded arjs="trackingMethod: best; sourceType: webcam; facingMode: user; debugUIEnabled: false;">
    <a-marker id="dynamicMarker" emitevents="true"></a-marker>
    <a-entity camera></a-entity>
  </a-scene>

  <script>
    const params = new URLSearchParams(window.location.search);

    // Ambil params
    let modelUrl = params.get("model");
    let markerUrl = params.get("marker");
    let scaleModel = params.get("scale");

    // Default
    if (!modelUrl) modelUrl = "/model/Solar System.glb";

    // Marker logic
    const marker = document.getElementById("dynamicMarker");
    if (markerUrl) {
      marker.setAttribute("type", "pattern");
      marker.setAttribute("url", markerUrl);
    } else {
      marker.setAttribute("preset", "hiro");
    }

    // Tambahkan model
    const model = document.createElement("a-entity");
    model.setAttribute("gltf-model", modelUrl);
    model.setAttribute("animation", "property: rotation; to: 0 360 0; loop: true; dur: 8000; easing: linear");
    marker.appendChild(model);

    // === AUTO SCALE LOGIC ===
    model.addEventListener("model-loaded", (e) => {
      const obj = e.detail.model;

      // Hitung ukuran bounding box model
      const box = new THREE.Box3().setFromObject(obj);
      const size = box.getSize(new THREE.Vector3());

      // Tentukan target ukuran maksimum (misal tinggi maksimum 1 unit)
      const maxDimension = Math.max(size.x, size.y, size.z);
      const targetSize = scaleModel ? parseFloat(scaleModel) : 1; // kamu bisa ubah (misal 0.5 biar lebih kecil) 

      // Hitung rasio skala otomatis
      const scaleValue = targetSize / maxDimension;

      // Terapkan skala yang sama ke semua sumbu
      model.setAttribute("scale", `${scaleValue} ${scaleValue} ${scaleValue}`);

      console.log("Auto scale applied:", scaleValue);
    });
  </script>
</body>
</html>
