<!DOCTYPE html>
<html lang="id">
   <head>
      <meta charset="utf-8" />
      <title>ARcade AR Viewer</title>
      <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
      <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.2/aframe/build/aframe-ar.min.js"></script>
      <style>
         body {
            margin: 0;
            overflow: hidden;
         }
      </style>
   </head>

   <body>
      <a-scene embedded arjs="trackingMethod: best; sourceType: webcam; facingMode: user; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;">
         <a-marker id="dynamicMarker" type="barcode" emitevents="true"></a-marker>
         <a-entity camera></a-entity>
      </a-scene>

      <script>
         const params = new URLSearchParams(window.location.search);

         // Ambil params
         let modelUrl = params.get("model") || "/model/astronomi/tata-surya.glb";
         let scaleModel = params.get("scale") || 1;
         let markerParam = params.get("marker") || params.get("barcode") || "1";

         // Ambil angka dari nama file marker, misal "1.png" -> 1
         let barcodeValue = parseInt(markerParam.match(/\d+/)?.[0] || markerParam, 10);

         const marker = document.getElementById("dynamicMarker");
         marker.setAttribute("type", "barcode");
         marker.setAttribute("value", barcodeValue);

         // Tambahkan model
         const model = document.createElement("a-entity");
         model.setAttribute("gltf-model", modelUrl);
         model.setAttribute("animation", "property: rotation; to: 0 360 0; loop: true; dur: 8000; easing: linear");
         marker.appendChild(model);

         // AUTO SCALE
         model.addEventListener("model-loaded", (e) => {
            const obj = e.detail.model;
            const box = new THREE.Box3().setFromObject(obj);
            const size = box.getSize(new THREE.Vector3());
            const maxDimension = Math.max(size.x, size.y, size.z);
            const scaleValue = parseFloat(scaleModel) / maxDimension;
            model.setAttribute("scale", `${scaleValue} ${scaleValue} ${scaleValue}`);
            console.log("Auto scale applied:", scaleValue);
         });
      </script>
   </body>
</html>
